---
import { cx } from "class-variance-authority";
import BaseLayout from "@layouts/BaseLayout.astro";
import HorizontalCard from "@components/HorizontalCard.astro";
import { allTags } from '@lib/tags'

export async function getStaticPaths() {

  const tags = await allTags()

  return tags.map(tag => ({
    params: { tag },
    props: { 
      projects: projects.filter(x => x.data.tags.includes(tag)),
      foss: foss.filter(x => x.data.tags.includes(tag)),
    },
  }));
}

const { tag } = Astro.params
const { projects, foss } = Astro.props
---

<BaseLayout title=`Projects with ${tag}` sideBarActiveItemID="projects">
  {projects.map((p, idx) => (
    <>
      <div class={cx('divider my-0', { 'hidden': idx === 0})}></div>
      <HorizontalCard
        title={`${p.data.title}, ${p.data.customer}`}
        img="/post_img.webp"
        desc={`From ${p.data.from} to ${p.data.to}, ${p.data.role}`}
        url={`/projects/${p.slug}`}
        target="_self"
      />
    </>
  ))}

  {foss.map((p, idx) => (
    <div class={cx({ 'mt-16': idx === 0})}>
      <div class={cx('divider my-0', { 'hidden': idx === 0})}></div>
      <HorizontalCard
        title={p.data.title}
        img="/post_img.webp"
        desc={p.data.description}
        url={p.data.url}
        badge="GitHub"
        tags={p.data.tags}
        tagUrl="/projects"
      />
    </div>
  ))}

</BaseLayout>
